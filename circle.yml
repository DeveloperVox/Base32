machine:
  timezone:
    Asia/Tokyo
  xcode:
    version: "6.3.1"

dependencies:
  cache_directories:
    - "vendor/bundle"
  pre:
    - curl 'https://developer.apple.com/certificationauthority/AppleWWDRCA.cer' -o certificates/AppleWWDRCA.cer
    - brew update
    - brew install carthage
  override:
    - bundle install --path=vendor/bundle --binstubs=vendor/bin
    - bundle exec rake certificates:install
    - carthage checkout
    - carthage build --no-skip-current

test:
  override:
    - set -o pipefail &&
      xcodebuild
        -scheme "Base32-iOS"
        -sdk iphonesimulator
        -destination 'platform=iOS Simulator,OS=8.1,name=iPhone 6'
        -project Base32.xcodeproj
        -configuration Release
        clean test |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/ios-results.xml
    - set -o pipefail &&
      xcodebuild
        -scheme "Base32-Mac"
        -sdk macosx
        -project Base32.xcodeproj
        -configuration Release
        clean test |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/mac-results.xml
    - set -o pipefail &&
      xcodebuild
        -scheme "SecEncodeTransformTests"
        -sdk macosx
        -project Base32.xcodeproj
        -configuration Release
        clean test |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/SecEncodeTransformTests-results.xml

notify:
  webhooks:
    - url: $webhook_url
